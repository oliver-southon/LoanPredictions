
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>c08dbc5f50c94fe2a14088af819c740b</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="WgEuXyUyArqq" data-outputId="503770ea-261b-46fe-ee45-ca4e2e148874">
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install shap</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shap</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install lime</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lime</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> lime.lime_tabular</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install aix360</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> aix360.algorithms.protodash <span class="im">import</span> ProtodashExplainer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> Normalizer</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> PowerTransformer</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.neural_network <span class="im">import</span> MLPClassifier</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, ConfusionMatrixDisplay</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score, make_scorer, accuracy_score, plot_confusion_matrix</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> plot_importance</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> linear_model</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action <span class="op">=</span><span class="st">&#39;ignore&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: shap in /usr/local/lib/python3.7/dist-packages (0.34.0)
Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from shap) (1.7.3)
Requirement already satisfied: tqdm&gt;4.25.0 in /usr/local/lib/python3.7/dist-packages (from shap) (4.64.1)
Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from shap) (1.3.5)
Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from shap) (1.0.2)
Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from shap) (1.21.6)
Requirement already satisfied: python-dateutil&gt;=2.7.3 in /usr/local/lib/python3.7/dist-packages (from pandas-&gt;shap) (2.8.2)
Requirement already satisfied: pytz&gt;=2017.3 in /usr/local/lib/python3.7/dist-packages (from pandas-&gt;shap) (2022.2.1)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil&gt;=2.7.3-&gt;pandas-&gt;shap) (1.15.0)
Requirement already satisfied: joblib&gt;=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn-&gt;shap) (1.1.0)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn-&gt;shap) (3.1.0)
Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: lime in /usr/local/lib/python3.7/dist-packages (0.1.1.37)
Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from lime) (1.21.6)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from lime) (3.2.2)
Requirement already satisfied: scikit-learn&gt;=0.18 in /usr/local/lib/python3.7/dist-packages (from lime) (1.0.2)
Requirement already satisfied: scikit-image&gt;=0.12 in /usr/local/lib/python3.7/dist-packages (from lime) (0.18.3)
Requirement already satisfied: progressbar in /usr/local/lib/python3.7/dist-packages (from lime) (2.5)
Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from lime) (1.7.3)
Requirement already satisfied: networkx&gt;=2.0 in /usr/local/lib/python3.7/dist-packages (from scikit-image&gt;=0.12-&gt;lime) (2.6.3)
Requirement already satisfied: tifffile&gt;=2019.7.26 in /usr/local/lib/python3.7/dist-packages (from scikit-image&gt;=0.12-&gt;lime) (2021.11.2)
Requirement already satisfied: PyWavelets&gt;=1.1.1 in /usr/local/lib/python3.7/dist-packages (from scikit-image&gt;=0.12-&gt;lime) (1.3.0)
Requirement already satisfied: pillow!=7.1.0,!=7.1.1,&gt;=4.3.0 in /usr/local/lib/python3.7/dist-packages (from scikit-image&gt;=0.12-&gt;lime) (7.1.2)
Requirement already satisfied: imageio&gt;=2.3.0 in /usr/local/lib/python3.7/dist-packages (from scikit-image&gt;=0.12-&gt;lime) (2.9.0)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;lime) (3.0.9)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;lime) (1.4.4)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;lime) (2.8.2)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;lime) (0.11.0)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from kiwisolver&gt;=1.0.1-&gt;matplotlib-&gt;lime) (4.1.1)
Requirement already satisfied: six&gt;=1.5 in /usr/local/lib/python3.7/dist-packages (from python-dateutil&gt;=2.1-&gt;matplotlib-&gt;lime) (1.15.0)
Requirement already satisfied: joblib&gt;=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn&gt;=0.18-&gt;lime) (1.1.0)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn&gt;=0.18-&gt;lime) (3.1.0)
Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/
Requirement already satisfied: aix360 in /usr/local/lib/python3.7/dist-packages (0.2.1)
Requirement already satisfied: torchvision in /usr/local/lib/python3.7/dist-packages (from aix360) (0.13.1+cu113)
Requirement already satisfied: bleach&gt;=2.1.0 in /usr/local/lib/python3.7/dist-packages (from aix360) (5.0.1)
Requirement already satisfied: xport in /usr/local/lib/python3.7/dist-packages (from aix360) (3.6.1)
Requirement already satisfied: shap==0.34.0 in /usr/local/lib/python3.7/dist-packages (from aix360) (0.34.0)
Requirement already satisfied: cvxopt in /usr/local/lib/python3.7/dist-packages (from aix360) (1.3.0)
Requirement already satisfied: scikit-learn&gt;=0.21.2 in /usr/local/lib/python3.7/dist-packages (from aix360) (1.0.2)
Requirement already satisfied: scipy&gt;=0.17 in /usr/local/lib/python3.7/dist-packages (from aix360) (1.7.3)
Requirement already satisfied: xgboost==1.0.2 in /usr/local/lib/python3.7/dist-packages (from aix360) (1.0.2)
Requirement already satisfied: Image in /usr/local/lib/python3.7/dist-packages (from aix360) (1.5.33)
Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from aix360) (1.21.6)
Requirement already satisfied: pandas in /usr/local/lib/python3.7/dist-packages (from aix360) (1.3.5)
Requirement already satisfied: keras==2.3.1 in /usr/local/lib/python3.7/dist-packages (from aix360) (2.3.1)
Requirement already satisfied: docutils&gt;=0.13.1 in /usr/local/lib/python3.7/dist-packages (from aix360) (0.17.1)
Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from aix360) (2.23.0)
Requirement already satisfied: scikit-image in /usr/local/lib/python3.7/dist-packages (from aix360) (0.18.3)
Requirement already satisfied: tensorflow==1.14 in /usr/local/lib/python3.7/dist-packages (from aix360) (1.14.0)
Requirement already satisfied: Pygments in /usr/local/lib/python3.7/dist-packages (from aix360) (2.6.1)
Requirement already satisfied: cvxpy in /usr/local/lib/python3.7/dist-packages (from aix360) (1.2.1)
Requirement already satisfied: torch in /usr/local/lib/python3.7/dist-packages (from aix360) (1.12.1+cu113)
Requirement already satisfied: qpsolvers in /usr/local/lib/python3.7/dist-packages (from aix360) (2.3.0)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.7/dist-packages (from aix360) (3.2.2)
Requirement already satisfied: joblib&gt;=0.11 in /usr/local/lib/python3.7/dist-packages (from aix360) (1.1.0)
Requirement already satisfied: lime==0.1.1.37 in /usr/local/lib/python3.7/dist-packages (from aix360) (0.1.1.37)
Requirement already satisfied: pyyaml in /usr/local/lib/python3.7/dist-packages (from keras==2.3.1-&gt;aix360) (6.0)
Requirement already satisfied: six&gt;=1.9.0 in /usr/local/lib/python3.7/dist-packages (from keras==2.3.1-&gt;aix360) (1.15.0)
Requirement already satisfied: h5py in /usr/local/lib/python3.7/dist-packages (from keras==2.3.1-&gt;aix360) (3.1.0)
Requirement already satisfied: keras-applications&gt;=1.0.6 in /usr/local/lib/python3.7/dist-packages (from keras==2.3.1-&gt;aix360) (1.0.8)
Requirement already satisfied: keras-preprocessing&gt;=1.0.5 in /usr/local/lib/python3.7/dist-packages (from keras==2.3.1-&gt;aix360) (1.1.2)
Requirement already satisfied: progressbar in /usr/local/lib/python3.7/dist-packages (from lime==0.1.1.37-&gt;aix360) (2.5)
Requirement already satisfied: tqdm&gt;4.25.0 in /usr/local/lib/python3.7/dist-packages (from shap==0.34.0-&gt;aix360) (4.64.1)
Requirement already satisfied: wheel&gt;=0.26 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (0.37.1)
Requirement already satisfied: gast&gt;=0.2.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (0.5.3)
Requirement already satisfied: google-pasta&gt;=0.1.6 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (0.2.0)
Requirement already satisfied: astor&gt;=0.6.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (0.8.1)
Requirement already satisfied: wrapt&gt;=1.11.1 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (1.14.1)
Requirement already satisfied: protobuf&gt;=3.6.1 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (3.17.3)
Requirement already satisfied: grpcio&gt;=1.8.6 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (1.48.1)
Requirement already satisfied: tensorflow-estimator&lt;1.15.0rc0,&gt;=1.14.0rc0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (1.14.0)
Requirement already satisfied: absl-py&gt;=0.7.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (1.2.0)
Requirement already satisfied: termcolor&gt;=1.1.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (1.1.0)
Requirement already satisfied: tensorboard&lt;1.15.0,&gt;=1.14.0 in /usr/local/lib/python3.7/dist-packages (from tensorflow==1.14-&gt;aix360) (1.14.0)
Requirement already satisfied: webencodings in /usr/local/lib/python3.7/dist-packages (from bleach&gt;=2.1.0-&gt;aix360) (0.5.1)
Requirement already satisfied: imageio&gt;=2.3.0 in /usr/local/lib/python3.7/dist-packages (from scikit-image-&gt;aix360) (2.9.0)
Requirement already satisfied: tifffile&gt;=2019.7.26 in /usr/local/lib/python3.7/dist-packages (from scikit-image-&gt;aix360) (2021.11.2)
Requirement already satisfied: networkx&gt;=2.0 in /usr/local/lib/python3.7/dist-packages (from scikit-image-&gt;aix360) (2.6.3)
Requirement already satisfied: PyWavelets&gt;=1.1.1 in /usr/local/lib/python3.7/dist-packages (from scikit-image-&gt;aix360) (1.3.0)
Requirement already satisfied: pillow!=7.1.0,!=7.1.1,&gt;=4.3.0 in /usr/local/lib/python3.7/dist-packages (from scikit-image-&gt;aix360) (7.1.2)
Requirement already satisfied: cycler&gt;=0.10 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;aix360) (0.11.0)
Requirement already satisfied: python-dateutil&gt;=2.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;aix360) (2.8.2)
Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,&gt;=2.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;aix360) (3.0.9)
Requirement already satisfied: kiwisolver&gt;=1.0.1 in /usr/local/lib/python3.7/dist-packages (from matplotlib-&gt;aix360) (1.4.4)
Requirement already satisfied: typing-extensions in /usr/local/lib/python3.7/dist-packages (from kiwisolver&gt;=1.0.1-&gt;matplotlib-&gt;aix360) (4.1.1)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn&gt;=0.21.2-&gt;aix360) (3.1.0)
Requirement already satisfied: setuptools&gt;=41.0.0 in /usr/local/lib/python3.7/dist-packages (from tensorboard&lt;1.15.0,&gt;=1.14.0-&gt;tensorflow==1.14-&gt;aix360) (57.4.0)
Requirement already satisfied: werkzeug&gt;=0.11.15 in /usr/local/lib/python3.7/dist-packages (from tensorboard&lt;1.15.0,&gt;=1.14.0-&gt;tensorflow==1.14-&gt;aix360) (1.0.1)
Requirement already satisfied: markdown&gt;=2.6.8 in /usr/local/lib/python3.7/dist-packages (from tensorboard&lt;1.15.0,&gt;=1.14.0-&gt;tensorflow==1.14-&gt;aix360) (3.4.1)
Requirement already satisfied: importlib-metadata&gt;=4.4 in /usr/local/lib/python3.7/dist-packages (from markdown&gt;=2.6.8-&gt;tensorboard&lt;1.15.0,&gt;=1.14.0-&gt;tensorflow==1.14-&gt;aix360) (4.12.0)
Requirement already satisfied: zipp&gt;=0.5 in /usr/local/lib/python3.7/dist-packages (from importlib-metadata&gt;=4.4-&gt;markdown&gt;=2.6.8-&gt;tensorboard&lt;1.15.0,&gt;=1.14.0-&gt;tensorflow==1.14-&gt;aix360) (3.8.1)
Requirement already satisfied: osqp&gt;=0.4.1 in /usr/local/lib/python3.7/dist-packages (from cvxpy-&gt;aix360) (0.6.2.post0)
Requirement already satisfied: ecos&gt;=2 in /usr/local/lib/python3.7/dist-packages (from cvxpy-&gt;aix360) (2.0.10)
Requirement already satisfied: scs&gt;=1.1.6 in /usr/local/lib/python3.7/dist-packages (from cvxpy-&gt;aix360) (3.2.0)
Requirement already satisfied: qdldl in /usr/local/lib/python3.7/dist-packages (from osqp&gt;=0.4.1-&gt;cvxpy-&gt;aix360) (0.1.5.post2)
Requirement already satisfied: cached-property in /usr/local/lib/python3.7/dist-packages (from h5py-&gt;keras==2.3.1-&gt;aix360) (1.5.2)
Requirement already satisfied: django in /usr/local/lib/python3.7/dist-packages (from Image-&gt;aix360) (3.2.15)
Requirement already satisfied: pytz in /usr/local/lib/python3.7/dist-packages (from django-&gt;Image-&gt;aix360) (2022.2.1)
Requirement already satisfied: sqlparse&gt;=0.2.2 in /usr/local/lib/python3.7/dist-packages (from django-&gt;Image-&gt;aix360) (0.4.2)
Requirement already satisfied: asgiref&lt;4,&gt;=3.3.2 in /usr/local/lib/python3.7/dist-packages (from django-&gt;Image-&gt;aix360) (3.5.2)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;aix360) (2022.6.15)
Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;aix360) (1.24.3)
Requirement already satisfied: chardet&lt;4,&gt;=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;aix360) (3.0.4)
Requirement already satisfied: idna&lt;3,&gt;=2.5 in /usr/local/lib/python3.7/dist-packages (from requests-&gt;aix360) (2.10)
Requirement already satisfied: click&gt;=7.1.1 in /usr/local/lib/python3.7/dist-packages (from xport-&gt;aix360) (7.1.2)
</code></pre>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Wq5r-I69ehzA" data-outputId="222d69a6-7e2d-4e36-ae7f-ffcfc10bea31">
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">&#39;/content/drive&#39;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(&quot;/content/drive&quot;, force_remount=True).
</code></pre>
</div>
</div>
<section id="new-section" class="cell markdown" id="DT9IBgCF6wiK">
<h1>New Section</h1>
</section>
<div class="cell markdown" id="lGE-f8wr43m3">
<p>change the directory according to your dirve</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="gYoMA4vpBXpG" data-outputId="8f1de2bf-eed1-4ae5-e111-3cc187127ef1">
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#from google.colab import drive</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#drive.mount(&#39;/content/drive&#39;)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>heloc <span class="op">=</span> pd.read_csv(<span class="st">&quot;heloc.csv&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(heloc.shape)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#heloc.head()</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>(10459, 24)
</code></pre>
</div>
</div>
<section id="1-eda" class="cell markdown" id="Y03UL2ThpT23">
<h1><strong>1. EDA</strong></h1>
</section>
<section id="label-encoding" class="cell markdown" id="63OrwAkgiisO">
<h3><strong>Label Encoding</strong></h3>
</section>
<div class="cell markdown" id="IqTUgUWYcYxZ">
<p>"Bad":1<br />
"Good":0</p>
</div>
<div class="cell code" id="iTpxvIE9c3tT">
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span> heloc.copy()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df.replace({<span class="st">&quot;Bad&quot;</span>:<span class="dv">1</span>, <span class="st">&quot;Good&quot;</span>:<span class="dv">0</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#df.head()</span></span></code></pre></div>
</div>
<div class="cell code" id="87lRNvkukVgq">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#df.info()</span></span></code></pre></div>
</div>
<div class="cell markdown" id="sFCHpO5Skq1A">
<p><strong>Separating predictor features</strong></p>
</div>
<div class="cell code" id="7iQbOnmcBbi5">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># take the label away</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>predictor <span class="op">=</span> heloc.iloc[:, <span class="dv">1</span>:].copy()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">#predictor.info()</span></span></code></pre></div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="LNAsEsyGFlBr" data-outputId="54f09cce-bba2-4a71-9258-d86b18bc24ac">
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;SPECIAL VALUES: &quot;)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">for i in range(23):</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">    print(i+1, &quot;.&quot;, predictor.iloc[:, i].name, end=&#39;: &#39;)</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">    for x in predictor.iloc[:, i].unique():</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">        if x &lt; 0:</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">            print(x, end=&#39;, &#39;)</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">    print()</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    &#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="20">
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="ed8NfFbMGZEv">
<p>-&gt; All predictor columns have special values</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Mhgl7WlccAQ5" data-outputId="0ea78ae8-0531-409e-d548-e5e96ad226e0">
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">for i in range(23):</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">  print(predictor.iloc[:, i].name, end=&#39;: &#39;)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">  print(predictor.iloc[:, i].unique())</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">  print()</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">  &#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="21">
<div class="sourceCode" id="cb13"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="VV3W3nuWJSbh">
<p>Value Meaning</p>
<p>-9 : No Bureau Record or No Investigation</p>
<p>-8 : No Usable/Valid Trades or Inquiries</p>
<p>-7: Condition not Met (e.g. No Inquiries, No Delinquencies)</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="POk-0fZ4vZs_" data-outputId="3148d71f-cd4d-43c5-a480-e60141aa8798">
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the index of special values</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">indices = []</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">for i in range(df.shape[0]):</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">  conditon = predictor.iloc[i, :] &lt;0</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">  if conditon.any():</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">    indices.append(i)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># there 7957 rows have missing values which is a lot -&gt; should not delete them</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">len(indices)</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="22">
<div class="sourceCode" id="cb15"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="roC4xTVfcuvO">
<p><strong>Due with Special Values</strong></p>
</div>
<div class="cell code" id="5vZiPxZ7z6lM">
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace special valuess to nan</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>df.replace({<span class="op">-</span><span class="dv">7</span>:np.NaN, <span class="op">-</span><span class="dv">8</span>:np.NaN, <span class="op">-</span><span class="dv">9</span>:np.NaN}, inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" id="6Mczfm__dgJK">
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace nan to mean</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">24</span>,<span class="dv">1</span>):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  df.iloc[:, i] <span class="op">=</span> df.iloc[:, i].fillna(df.iloc[:, i].mean().<span class="bu">round</span>())</span></code></pre></div>
</div>
<div class="cell markdown" id="NQoj25xfRF0h">
<p>IMPORTANCE FEATURES:</p>
<ol>
<li>ExternalRiskEstimate</li>
<li>NumTrades60Ever2DerogPubRec</li>
<li>PercentInstallTrades</li>
<li>NetFractionInstallBurden</li>
<li>NumRevolvingTradesWBalance</li>
<li>NumInstallTradesWBalance</li>
<li>PercentTradesWBalance</li>
</ol>
</div>
<div class="cell code" id="IR9UlfNSb2af">
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>correlation_coefficient <span class="op">=</span> df.iloc[:, <span class="dv">1</span>:].corr().<span class="bu">round</span>(<span class="dv">1</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#correlation_coefficient</span></span></code></pre></div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ryZfYWE-f43Q" data-outputId="c8894bf8-a28b-4eb0-a208-70a53f7b7208">
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.zeros_like(correlation_coefficient)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mask[np.triu_indices_from(mask)] <span class="op">=</span> <span class="va">True</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> sns.axes_style(<span class="st">&quot;white&quot;</span>):</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    f, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> sns.heatmap(correlation_coefficient, mask<span class="op">=</span>mask, vmax<span class="op">=</span><span class="dv">1</span>, square<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/6e52adeed4da775d870c46f7127aec05b3a3e4b4.png" /></p>
</div>
</div>
<section id="1-1-spliting-data" class="cell markdown" id="LfhZd_QouTUY">
<h3><strong>1. 1 Spliting Data</strong></h3>
<p>I splited data into 3 subsets (Train, Test and Dummy)</p>
<p>Dummy set is used for Front end (Pay Attention <strong>Oliver</strong>)</p>
</section>
<div class="cell markdown" id="gVn42LFoc-Av">
<p>Divide data into 3 subsets<br />
Train<br />
Test<br />
Dummy (for frontend experiment)</p>
</div>
<div class="cell code" id="YAH21ejbAdOW">
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df.drop(<span class="st">&#39;RiskPerformance&#39;</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df[<span class="st">&#39;RiskPerformance&#39;</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X,y, test_size<span class="op">=</span><span class="fl">0.33</span>, random_state<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>X_test, X_dummy, y_test, y_dummy <span class="op">=</span> train_test_split(X_test, y_test, test_size<span class="op">=</span><span class="fl">0.002</span>, random_state<span class="op">=</span><span class="dv">8</span>)</span></code></pre></div>
</div>
<div class="cell code" id="Qevi9OO6dA5g">
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data for Frontend</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#X_dummy</span></span></code></pre></div>
</div>
<section id="2-train-model" class="cell markdown" id="xxvwKW8ElEjO">
<h1><strong>2. Train model</strong></h1>
<p><strong><em>3 models: XGBoost, Decision Tree and Support Vector Machine</em></strong></p>
</section>
<section id="neural-network-dont-use-this" class="cell markdown" id="WaEKtb84lOUD">
<h2><strong>Neural Network</strong> (Dont use this)</h2>
<p>Give 70% accuracy but Can't get the shap to work on this model</p>
</section>
<div class="cell code" id="Y8JnsmkesJdQ">
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#X = df.drop(&#39;RiskPerformance&#39;, axis=1).to_numpy()</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Y = df[&#39;RiskPerformance&#39;].to_numpy()</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#X_train, X_test, y_train, y_test = train_test_split(X,Y, test_size=0.33, random_state=42)</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#neural_net = make_pipeline(</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#StandardScaler(),</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">#MLPClassifier(hidden_layer_sizes=(3,),activation=&#39;relu&#39;,solver=&#39;adam&#39;,  max_iter=10000,learning_rate=&#39;constant&#39;,random_state=0, early_stopping=True)   </span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#neural_net.fit(X_train, y_train)</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#neural_net.predict_proba(X_test[0:])</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#neural_net.score(X_test, y_test)</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#explainer = shap.KernelExplainer(neural_net.predict,X_train)</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#shap_values = explainer.shap_values(X_test,nsamples=100)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#shap.summary_plot(shap_values,X_test,feature_names=features)</span></span></code></pre></div>
</div>
<section id="21-xgboost" class="cell markdown" id="cPBHhEEy-PPI">
<h2><strong>2.1 XGBOOST</strong></h2>
</section>
<div class="cell markdown" id="cQlupY3kdYKR">
<p><strong>Build model</strong></p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="qyeuu3Wy_RPi" data-outputId="b8d28da6-c73d-4475-a83d-9ba2a1cb780e">
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="op">=</span> xgb.XGBClassifier(objective<span class="op">=</span><span class="st">&quot;reg:logistic&quot;</span>, </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>                              seed<span class="op">=</span><span class="dv">70</span>, </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>                              col_sample_bytree<span class="op">=</span><span class="fl">0.4</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>                              learning_rate<span class="op">=</span> <span class="fl">0.01</span>, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>                              max_depth<span class="op">=</span> <span class="dv">5</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>                              n_estimators<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>                              alpha<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>xgb_model.fit(X_train.values, y_train)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plot_confusion_matrix(xgb_model,X_test.values,  y_test, values_format<span class="op">=</span><span class="st">&#39;d&#39;</span>, display_labels <span class="op">=</span>[<span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Bad&quot;</span>]  )</span></code></pre></div>
<div class="output execute_result" data-execution_count="30">
<pre><code>&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x7f5d53cdd490&gt;</code></pre>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/fa0c75e64cf50ba2e01c429cc04b78e3dc2be728.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="YUMc0p19afEQ" data-outputId="76ae1776-1d7d-49c9-a29d-7373f2871f32">
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="op">=</span> xgb_model.predict(X_test.values)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Training accuracy:&#39;</span>, accuracy_score(y_train, xgb_model.predict(X_train.values)))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;Test accuracy:&#39;</span>, accuracy_score(y_test, xgb_pred))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&#39;ROC_AUC: &#39;</span>, roc_auc_score(y_test, xgb_pred))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test, xgb_pred, target_names<span class="op">=</span>[<span class="st">&quot;Approved&quot;</span>, <span class="st">&quot;Denied&quot;</span>]))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Training accuracy: 0.7502497502497503
Test accuracy: 0.7277213352685051
ROC_AUC:  0.725206759514518
              precision    recall  f1-score   support

    Approved       0.74      0.67      0.70      1643
      Denied       0.72      0.78      0.75      1802

    accuracy                           0.73      3445
   macro avg       0.73      0.73      0.73      3445
weighted avg       0.73      0.73      0.73      3445

</code></pre>
</div>
</div>
<div class="cell code" id="IIGJuplOi4Ut">
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># feature importance</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_importance(xgb_model, )</span></span></code></pre></div>
</div>
<div class="cell markdown" id="HOnj3f3ySUbW">
<p>Create a test dataframe which consists of actual label and predicted label</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Wq5X9fwMSS0K" data-outputId="7e03bf88-e6b6-4a75-9f95-c640502ed830">
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> y_test.to_frame()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&#39;predict&#39;</span>] <span class="op">=</span> xgb_pred</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>test.rename(columns<span class="op">=</span>{<span class="st">&quot;RiskPerformance&quot;</span>:<span class="st">&quot;actual&quot;</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>test.sample(<span class="dv">5</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="33">

  <div id="df-fcea1e32-fd8b-4df7-9a0c-67d923b501f1">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>actual</th>
      <th>predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10262</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6106</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5382</th>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4244</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3476</th>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-fcea1e32-fd8b-4df7-9a0c-67d923b501f1')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-fcea1e32-fd8b-4df7-9a0c-67d923b501f1 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-fcea1e32-fd8b-4df7-9a0c-67d923b501f1');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ZnY9N5fXijgs" data-outputId="e2de0545-72a4-4b9a-e560-915cc2e01f46">
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">explainer = lime.lime_tabular.LimeTabularExplainer(X_train.values, </span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   feature_names=predictor.columns, </span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   verbose=True, </span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   class_names=[&#39;Approved&#39;, &#39;Denied&#39;],</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   mode=&#39;classification&#39;)</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="34">
<div class="sourceCode" id="cb30"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="9DEbjQrS1qsL">
<p>Separating approved and denied observations from test set</p>
</div>
<div class="cell code" id="hjx-ZeITyShD">
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>denied <span class="op">=</span> test[test[<span class="st">&#39;predict&#39;</span>]<span class="op">==</span> <span class="dv">1</span>].index</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>approved <span class="op">=</span> test[test[<span class="st">&#39;predict&#39;</span>]<span class="op">==</span> <span class="dv">0</span>].index</span></code></pre></div>
</div>
<div class="cell markdown" id="A18WsxQl153K">
<p><strong><em>Visualizing Bad observations</em></strong> based on prediction</p>
</div>
<div class="cell markdown" id="UVVaCI6wMein">
<p>Observation 1:</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ir4wdGJY65b3" data-outputId="44bdfb65-2db7-4d2b-db4e-839cc20b8df6">
<div class="sourceCode" id="cb32"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">denied_index =np.random.choice(denied )</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">print(y_test.loc[denied_index])</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">X_test.loc[denied_index]</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="36">
<div class="sourceCode" id="cb33"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="SCXGj5QZi3C3" data-outputId="fdd4bc05-4d3e-4768-c5c4-d186c61c0ae1">
<div class="sourceCode" id="cb34"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co">print(&#39;Predict:&#39;,test.loc[denied_index, &quot;predict&quot;])</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">#xgb_model.predict(X_test.loc[bad_index])[0]</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;Actual:&quot; , test.loc[denied_index, &#39;actual&#39;])</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">exp = explainer.explain_instance(X_test.loc[denied_index],  xgb_model.predict_proba, num_features=23)</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">exp.show_in_notebook(show_table=True)</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="37">
<div class="sourceCode" id="cb35"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="zXKDNQ6XMjnR">
<p>Observation 2: Wrong Prediction</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="BV2pbTLVLvCJ" data-outputId="e842865f-1ec4-4d41-9f9a-43f811e93f92">
<div class="sourceCode" id="cb36"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">wrong_predit = []</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">for i in test.index:</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">  if test.loc[i, &#39;predict&#39;] == 1 :</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">    if test.loc[i, &#39;actual&#39;] == 0:</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">      wrong_predit.append(i)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="38">
<div class="sourceCode" id="cb37"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="hbholVo9USEC" data-outputId="b1471b55-3c23-412a-9f97-ce12d7bb4cd4">
<div class="sourceCode" id="cb38"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">bad_index =np.random.choice(wrong_predit)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">print(&#39;Predict:&#39;,test.loc[denied_index, &quot;predict&quot;])</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;Actual:&quot; , test.loc[denied_index, &#39;actual&#39;])</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">exp = explainer.explain_instance(X_test.loc[denied_index ],  xgb_model.predict_proba, num_features=23)</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">exp.show_in_notebook(show_table=True)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="39">
<div class="sourceCode" id="cb39"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="CfU1qnCyR_TY">
<p>Observation 3:</p>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="z4zsGrn3R9qq" data-outputId="0dca2bb7-787f-434e-8d21-de2a60077185">
<div class="sourceCode" id="cb40"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co">bad_index =np.random.choice(denied)</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">print(&#39;Predict:&#39;,test.loc[denied_index, &quot;predict&quot;])</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;Actual:&quot; , test.loc[denied_index, &#39;actual&#39;])</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">exp = explainer.explain_instance(X_test.loc[denied_index],  xgb_model.predict_proba, num_features=23)</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">exp.show_in_notebook(show_table=True)</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="40">
<div class="sourceCode" id="cb41"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="tTg6rdmH2DWc">
<p><strong><em>Visualising Good Observations</em></strong></p>
</div>
<div class="cell markdown" id="ytNwXGIeMozY">
<p>Observation 1:</p>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:35,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="aMU9ch4gpwC2" data-outputId="7cf8bc20-28fe-4fb2-8345-e0c89d15c75c">
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">approved_index =np.random.choice(approved)</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">print(y_test.loc[approved_index])</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">X_test.loc[approved_index]</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="41">
<div class="sourceCode" id="cb43"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:70,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="x7RE1b2tKvSJ" data-outputId="44e8bc2f-b7fc-4256-c67a-b80a3a80a0af">
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">approved_index =np.random.choice(approved)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">print(&#39;Predict:&#39;,test.loc[approved_index, &quot;predict&quot;])</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;Actual:&quot; , test.loc[approved_index, &#39;actual&#39;])</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">exp = explainer.explain_instance(X_test.loc[approved_index],  xgb_model.predict_proba, num_features=23)</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">exp.show_in_notebook(show_table=True)</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="42">
<div class="sourceCode" id="cb45"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="32Oa7c8rMrmc">
<p>Observation 2:</p>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:70,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="-iiTDKh3K3Nj" data-outputId="4328d8a2-b95b-444f-81b0-5e9b18a7cf6b">
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">approved_index =np.random.choice(approved)</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">print(&#39;Predict:&#39;,test.loc[approved_index, &quot;predict&quot;])</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;Actual:&quot; , test.loc[approved_index, &#39;actual&#39;])</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">exp = explainer.explain_instance(X_test.loc[approved_index],  xgb_model.predict_proba, num_features=23)</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">exp.show_in_notebook(show_table=True)</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="43">
<div class="sourceCode" id="cb47"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell markdown" id="mnhamcP5are3">
<p>Observation 3: Wrong Prediction</p>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:87,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="Cjrc7iCZLZSG" data-outputId="b59f25d0-2e87-41c6-f8ac-290aa2a97e4b">
<div class="sourceCode" id="cb48"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co">wrong_predit = []</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co">for i in test.index:</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">  if test.loc[i, &#39;predict&#39;] == 0 :</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">    if test.loc[i, &#39;actual&#39;] == 1:</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co">      wrong_predit.append(i)</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">approved_index =np.random.choice(wrong_predit)</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">print(&#39;Predict:&#39;,test.loc[approved_index, &quot;predict&quot;])</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">print(&quot;Actual:&quot; , test.loc[approved_index, &#39;actual&#39;])</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">exp = explainer.explain_instance(X_test.loc[approved_index],  xgb_model.predict_proba, num_features=23)</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">exp.show_in_notebook(show_table=True)</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="44">
<div class="sourceCode" id="cb49"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<section id="22-decision-tree" class="cell markdown" id="bH6igS1Qr9lf">
<h1><strong>2.2 Decision Tree</strong></h1>
</section>
<div class="cell code" id="tJJ6W0lCr648">
<div class="sourceCode" id="cb50"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>new_list <span class="op">=</span> []</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>,<span class="dv">23</span>):</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    dt_model <span class="op">=</span> DecisionTreeClassifier(max_leaf_nodes <span class="op">=</span> k, random_state<span class="op">=</span><span class="dv">0</span>, criterion<span class="op">=</span><span class="st">&#39;entropy&#39;</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    fit<span class="op">=</span>dt_model.fit(X_train, y_train)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    dt_pred <span class="op">=</span> dt_model.predict(X_test)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    new_list.append(accuracy_score(y_test,dt_pred))</span></code></pre></div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="bqJ82WlHr7Cr" data-outputId="867d204e-5e20-40a9-d994-62459a8f2c56">
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plt.plot(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">10</span>,<span class="dv">23</span>)), new_list)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Acurracy score (DTC)&quot;</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&#39;number of selected features&#39;</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&#39;accuracy score&#39;</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/33aba0ceebeca548278997ee9aa5bbb1027d5ce8.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="nb_sbEl4r7Gz" data-outputId="5c5e95c8-494a-4d17-e782-905439572e55">
<div class="sourceCode" id="cb52"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>titles_options <span class="op">=</span> [(<span class="st">&quot;Confusion matrix, without normalization&quot;</span>, <span class="va">None</span>),</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                  (<span class="st">&quot;Normalized confusion matrix&quot;</span>, <span class="st">&#39;true&#39;</span>)]</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> title, normalize <span class="kw">in</span> titles_options:</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    disp <span class="op">=</span> plot_confusion_matrix(dt_model, X_test, y_test,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                                 cmap<span class="op">=</span>plt.cm.Blues,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                                 normalize<span class="op">=</span>normalize)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    disp.ax_.set_title(title)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/e598187cb997fb2d526fbdc67fc0b0fda184caeb.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/6704d6151c042fea8f21f405ea20210a9a87a9b0.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="a87ERTt7r7L7" data-outputId="c62b88fd-4f23-4dfa-cd92-31ea144eecbb">
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># classification report</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test,dt_pred))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

         0.0       0.71      0.63      0.67      1643
         1.0       0.70      0.77      0.73      1802

    accuracy                           0.70      3445
   macro avg       0.70      0.70      0.70      3445
weighted avg       0.70      0.70      0.70      3445

</code></pre>
</div>
</div>
<div class="cell code" id="X2B19XiZtVTy">
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<section id="23-support-vector-machine" class="cell markdown" id="6OUp3Qo-tlZi">
<h1>2.3 Support Vector Machine</h1>
</section>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="OUVxbeL2trKz" data-outputId="8b24ac25-eb79-42b2-b82a-7da0f02a0a01">
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>svc <span class="op">=</span> SVC(kernel<span class="op">=</span><span class="st">&#39;rbf&#39;</span>, probability<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>svc_model<span class="op">=</span> svc.fit(X_train, y_train)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>svc_pred <span class="op">=</span> svc.predict(X_test)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;Accuracy score:&quot;</span>, accuracy_score(y_test, svc_pred))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Accuracy score: 0.7239477503628448
</code></pre>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="NtULS5lgt0a-" data-outputId="c089abc3-dee1-44e0-eb2a-0d0865ca96a9">
<div class="sourceCode" id="cb58"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># confusion matrix</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>titles_options <span class="op">=</span> [(<span class="st">&quot;Confusion matrix, without normalization&quot;</span>, <span class="va">None</span>),</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>                  (<span class="st">&quot;Normalized confusion matrix&quot;</span>, <span class="st">&#39;true&#39;</span>)]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> title, normalize <span class="kw">in</span> titles_options:</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    disp <span class="op">=</span> plot_confusion_matrix(svc_model, X_test, y_test,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                                 cmap<span class="op">=</span>plt.cm.Blues,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>                                 normalize<span class="op">=</span>normalize)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    disp.ax_.set_title(title)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/ad08547818ce772554c6f0d47179ca1103fc5276.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/f17aeec700c834f8f69697b0e280cb4f1a4f92db.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="gHkRMWYFt3v7" data-outputId="5c735e5f-b1b1-4ccb-baa7-5883f0c51975">
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># classification report</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(y_test,svc_pred))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

         0.0       0.73      0.66      0.70      1643
         1.0       0.72      0.78      0.75      1802

    accuracy                           0.72      3445
   macro avg       0.73      0.72      0.72      3445
weighted avg       0.72      0.72      0.72      3445

</code></pre>
</div>
</div>
<div class="cell code" id="SIsCrsYbt4ki">
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<section id="3-global--instances-explaination" class="cell markdown" id="kZ-F_dilzI3U">
<h1><strong>3. Global &amp; Instances Explaination</strong></h1>
</section>
<div class="cell markdown" id="agrgCcYtbY9N">
<p><a href="https://coderzcolumn.com/tutorials/machine-learning/how-to-use-lime-to-understand-sklearn-models-predictions" class="uri">https://coderzcolumn.com/tutorials/machine-learning/how-to-use-lime-to-understand-sklearn-models-predictions</a></p>
<p><a href="https://www.kaggle.com/code/yohanb/explaining-xgb-model-with-lime/notebook" class="uri">https://www.kaggle.com/code/yohanb/explaining-xgb-model-with-lime/notebook</a></p>
</div>
<section id="31-xgboost" class="cell markdown" id="B5JuSCfJzYma">
<h2><strong>3.1 XGBoost</strong></h2>
</section>
<section id="311-global-explaination-by-shap-use-train-set" class="cell markdown" id="cPaQ1Wa2ze89">
<h3><strong>3.1.1 Global Explaination by SHAP</strong> (use train set)</h3>
</section>
<div class="cell code" id="3IxtbN_gp5k-">
<div class="sourceCode" id="cb62"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(xgb_model)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_train)</span></code></pre></div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="i4pdPlkwrjOx" data-outputId="d1ab8425-017a-4378-8ecc-ef0dc1c12ca7">
<div class="sourceCode" id="cb63"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_train)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># denied is 1</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># approved is 0</span></span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/1880480913fb7cd323eada43ae1bb28e8a4ff40f.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="kaPC05mjtezn" data-outputId="05d63888-c527-4a5e-b847-e4b179bedc9f">
<div class="sourceCode" id="cb64"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values, X_train, plot_type<span class="op">=</span><span class="st">&#39;bar&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/46f370edb93ea536d58930ed2e724c41865e2369.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="tLxcDcayvKi9" data-outputId="527e0b05-bed5-420b-cabf-0dc5c2a61898">
<div class="sourceCode" id="cb65"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">shap_sum = np.abs(shap_values).mean(axis=0)</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">importance_df = pd.DataFrame([X_test.columns.tolist(), shap_sum.tolist()]).T</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">importance_df.columns = [&#39;column_name&#39;, &#39;shap_importance&#39;]</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">importance_df = importance_df.sort_values(&#39;shap_importance&#39;, ascending=False)</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">importance_df</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="55">
<div class="sourceCode" id="cb66"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:1000,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="TAqdYUi8xrEA" data-outputId="5c530aa9-b271-4d53-90e1-b79442aae1dc">
<div class="sourceCode" id="cb67"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">7</span>):</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  shap.dependence_plot(i, shap_values, X_train)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/831d2bc4ed6ee1d331b21b2ba48e20f2ca0dd9a3.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/b1354d8aebb2188609176de109c1618505d36927.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/af6e2153859adf4da57267dd8970bb118a306447.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/e3613546be3b342cbb4efbddba6b07d292f9682d.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/7b907068490c1a0cf922ab812e64ae8252f50c65.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/56068dde796af3c7c0fbbc0a1ae1f78f710a3394.png" /></p>
</div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/80274074e9f1b1774438d38b4c39cd00c26ed0ba.png" /></p>
</div>
</div>
<div class="cell code" id="Hd3kgwIjf7yY">
<div class="sourceCode" id="cb68"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>xgb_model.get_booster().feature_names <span class="op">=</span> <span class="va">None</span></span></code></pre></div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="ClcvXG6wadA7" data-outputId="87c4b191-848a-4fe9-ded3-5d64b1c9f11e">
<div class="sourceCode" id="cb69"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># partial dependence of final prediction on ExternalRiskEstimate</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ExternalRiskEstimate&quot;</span>, xgb_model.predict, X_train, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/b7ed51386c7642bdbfe787a2c7315db65d278c79.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:305,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="syO0r5DkiIgQ" data-outputId="80699be6-2d81-4057-864d-dd081b270714">
<div class="sourceCode" id="cb70"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># partial dependence of final prediction on Mons Since MostRecentInqexcl7days</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MSinceMostRecentInqexcl7days&quot;</span>, xgb_model.predict, X_train, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/ade58e370d4280d204c787862ccd16fd32641eaa.png" /></p>
</div>
</div>
<div class="cell code" data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="C1pUAIp-jPEY" data-outputId="99b91ace-e265-4f1c-c8ae-7cd8c4b64883">
<div class="sourceCode" id="cb71"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># partial dependence of final prediction on PercentTradesNeverDelq</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;PercentTradesNeverDelq&quot;</span>, xgb_model.predict, X_train, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="output display_data">
<p><img src="vertopal_a6bcac9b2b094e3b996c17199600641a/de8dcb59e75db772d9e71be98dc2ab82b22174a3.png" /></p>
</div>
</div>
<section id="312-local-explaination-by-lime-use-dummy-data" class="cell markdown" id="jXxOAbD005CF">
<h3><strong>3.1.2 Local Explaination by LIME</strong> (use Dummy data)</h3>
</section>
<div class="cell code" data-colab="{&quot;height&quot;:70,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="dudBRVjt2whi" data-outputId="0288f426-950c-43fc-f5cb-b92e70768685">
<div class="sourceCode" id="cb72"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co">explainer = lime.lime_tabular.LimeTabularExplainer(X_train.values, </span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   feature_names=predictor.columns, </span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   verbose=True, </span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   class_names=[&#39;Approved&#39;, &#39;Denied&#39;],</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="co">                                                   mode=&#39;classification&#39;)</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
<div class="output execute_result" data-execution_count="61">
<div class="sourceCode" id="cb73"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;type&quot;</span><span class="fu">:</span><span class="st">&quot;string&quot;</span><span class="fu">}</span></span></code></pre></div>
</div>
</div>
<div class="cell code" id="fuiVwJhopYCF">
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cols_when_model_builds = xgb_model.get_booster().feature_names</span></span></code></pre></div>
</div>
<div class="cell code" data-colab="{&quot;height&quot;:572,&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}" id="FQDwTikwGIlW" data-outputId="1ba697d5-19e0-4954-8da7-750c75a27045">
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explain individual prediction using LimeTabularExplainer</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">#cols_when_model_builds = xgb_model.get_booster().feature_names</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> lime.lime_tabular.LimeTabularExplainer(X_train.values, </span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                                                   feature_names<span class="op">=</span>X_train.columns, </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                                                   verbose<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                                                   class_names<span class="op">=</span>[<span class="st">&#39;Approved&#39;</span>, <span class="st">&#39;Denied&#39;</span>],</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                                                   mode<span class="op">=</span><span class="st">&#39;classification&#39;</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, predict the 1st observation on dumm dataset</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>X_dummy_observation <span class="op">=</span> X_dummy.iloc[<span class="dv">0</span>]</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This is for front-end to pick the observation </span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>explanation <span class="op">=</span> explainer.explain_instance(X_dummy_observation.values, xgb_model.predict_proba)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>explanation.show_in_notebook()</span></code></pre></div>
<div class="output error" data-ename="ValueError" data-evalue="ignored">
<pre><code>---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
&lt;ipython-input-63-2e517ea1cbba&gt; in &lt;module&gt;
     12 X_dummy_observation = X_dummy.iloc[0]
     13         # This is for front-end to pick the observation
---&gt; 14 explanation = explainer.explain_instance(X_dummy_observation.values, xgb_model.predict_proba)
     15 explanation.show_in_notebook()

/usr/local/lib/python3.7/dist-packages/lime/lime_tabular.py in explain_instance(self, data_row, predict_fn, labels, top_labels, num_features, num_samples, distance_metric, model_regressor)
    353         ).ravel()
    354 
--&gt; 355         yss = predict_fn(inverse)
    356 
    357         # for classification, the model needs to provide a list of tuples - classes

/usr/local/lib/python3.7/dist-packages/xgboost/sklearn.py in predict_proba(self, data, ntree_limit, validate_features, base_margin)
    935         class_probs = self.get_booster().predict(test_dmatrix,
    936                                                  ntree_limit=ntree_limit,
--&gt; 937                                                  validate_features=validate_features)
    938         if self.objective == &quot;multi:softprob&quot;:
    939             return class_probs

/usr/local/lib/python3.7/dist-packages/xgboost/core.py in predict(self, data, output_margin, ntree_limit, pred_leaf, pred_contribs, approx_contribs, pred_interactions, validate_features, training)
   1441 
   1442         if validate_features:
-&gt; 1443             self._validate_features(data)
   1444 
   1445         length = c_bst_ulong()

/usr/local/lib/python3.7/dist-packages/xgboost/core.py in _validate_features(self, data)
   1860 
   1861                 raise ValueError(msg.format(self.feature_names,
-&gt; 1862                                             data.feature_names))
   1863 
   1864     def get_split_value_histogram(self, feature, fmap=&#39;&#39;, bins=None,

ValueError: feature_names mismatch: [&#39;ExternalRiskEstimate&#39;, &#39;MSinceOldestTradeOpen&#39;, &#39;MSinceMostRecentTradeOpen&#39;, &#39;AverageMInFile&#39;, &#39;NumSatisfactoryTrades&#39;, &#39;NumTrades60Ever2DerogPubRec&#39;, &#39;NumTrades90Ever2DerogPubRec&#39;, &#39;PercentTradesNeverDelq&#39;, &#39;MSinceMostRecentDelq&#39;, &#39;MaxDelq2PublicRecLast12M&#39;, &#39;MaxDelqEver&#39;, &#39;NumTotalTrades&#39;, &#39;NumTradesOpeninLast12M&#39;, &#39;PercentInstallTrades&#39;, &#39;MSinceMostRecentInqexcl7days&#39;, &#39;NumInqLast6M&#39;, &#39;NumInqLast6Mexcl7days&#39;, &#39;NetFractionRevolvingBurden&#39;, &#39;NetFractionInstallBurden&#39;, &#39;NumRevolvingTradesWBalance&#39;, &#39;NumInstallTradesWBalance&#39;, &#39;NumBank2NatlTradesWHighUtilization&#39;, &#39;PercentTradesWBalance&#39;] [&#39;f0&#39;, &#39;f1&#39;, &#39;f2&#39;, &#39;f3&#39;, &#39;f4&#39;, &#39;f5&#39;, &#39;f6&#39;, &#39;f7&#39;, &#39;f8&#39;, &#39;f9&#39;, &#39;f10&#39;, &#39;f11&#39;, &#39;f12&#39;, &#39;f13&#39;, &#39;f14&#39;, &#39;f15&#39;, &#39;f16&#39;, &#39;f17&#39;, &#39;f18&#39;, &#39;f19&#39;, &#39;f20&#39;, &#39;f21&#39;, &#39;f22&#39;]
expected NumTrades90Ever2DerogPubRec, MSinceMostRecentInqexcl7days, NumInqLast6M, MaxDelq2PublicRecLast12M, NumTotalTrades, NumSatisfactoryTrades, PercentInstallTrades, PercentTradesNeverDelq, MSinceOldestTradeOpen, PercentTradesWBalance, NumRevolvingTradesWBalance, AverageMInFile, NumTrades60Ever2DerogPubRec, NetFractionRevolvingBurden, NumBank2NatlTradesWHighUtilization, MSinceMostRecentDelq, NumTradesOpeninLast12M, MaxDelqEver, MSinceMostRecentTradeOpen, NetFractionInstallBurden, NumInstallTradesWBalance, NumInqLast6Mexcl7days, ExternalRiskEstimate in input data
training data did not have the following fields: f13, f16, f2, f21, f12, f9, f1, f18, f0, f19, f7, f10, f20, f5, f4, f3, f6, f11, f14, f8, f17, f22, f15
</code></pre>
</div>
</div>
<div class="cell markdown" id="ktJpeer07Qvm">
<p>** tabular format **</p>
</div>
<div class="cell code" id="gNURU6Ji7ZIc">
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>result_list <span class="op">=</span> explanation.as_list()</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [tup[<span class="dv">0</span>] <span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="bu">round</span>(tup[<span class="dv">1</span>], <span class="dv">2</span>)<span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>exp_df <span class="op">=</span> pd.DataFrame([values], columns<span class="op">=</span>columns)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>exp_df.T</span></code></pre></div>
</div>
<div class="cell markdown" id="6S_tSqyo-yoH">
<hr />
</div>
<section id="313-local-explanation-by-protodash" class="cell markdown" id="t89lWMdx8x1I">
<h3><strong>3.1.3 Local Explanation by ProtoDash</strong></h3>
<hr />
<hr />
</section>
<div class="cell code" id="stNSe9OB9Hnx">
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!pip install aix360</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">#from aix360.algorithms.protodash import ProtodashExplainer</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a><span class="co"># from google.colab import drive</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="co"># drive.mount(&#39;/content/drive&#39;)</span></span></code></pre></div>
</div>
<div class="cell code" id="1sc6m2dbPrzd">
<div class="sourceCode" id="cb79"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">### for front end, please use the function with the parameter &#39;client_database&#39;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="co">### for protodash to work we need to have the database from which we can extract similar clients; </span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co">### this database is the heloc.csv itself in our case</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="co">def display_similar_clients(ml_model, user_input, client_database): </span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co">    good_client_con = client_database[&#39;RiskPerformance&#39;] == 0</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="co">    good_client_profiles = client_database[good_client_con]</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="co">    bad_client_con = client_database[&#39;RiskPerformance&#39;] == 1</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="co">    bad_client_profiles = client_database[bad_client_con]</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a><span class="co">    index = [&#39;ExternalRiskEstimate&#39;, &#39;MSinceOldestTradeOpen&#39;,</span></span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;MSinceMostRecentTradeOpen&#39;, &#39;AverageMInFile&#39;, &#39;NumSatisfactoryTrades&#39;,</span></span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;NumTrades60Ever2DerogPubRec&#39;, &#39;NumTrades90Ever2DerogPubRec&#39;,</span></span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;PercentTradesNeverDelq&#39;, &#39;MSinceMostRecentDelq&#39;,</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;MaxDelq2PublicRecLast12M&#39;, &#39;MaxDelqEver&#39;, &#39;NumTotalTrades&#39;,</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;NumTradesOpeninLast12M&#39;, &#39;PercentInstallTrades&#39;,</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;MSinceMostRecentInqexcl7days&#39;, &#39;NumInqLast6M&#39;, &#39;NumInqLast6Mexcl7days&#39;,</span></span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;NetFractionRevolvingBurden&#39;, &#39;NetFractionInstallBurden&#39;,</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;NumRevolvingTradesWBalance&#39;, &#39;NumInstallTradesWBalance&#39;,</span></span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a><span class="co">       &#39;NumBank2NatlTradesWHighUtilization&#39;, &#39;PercentTradesWBalance&#39;]</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a><span class="co">    pred_dummy = ml_model.predict(np.array(user_input).reshape(1,-1))[0]</span></span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a><span class="co">    dummy_applicant = pd.concat([pd.Series({&#39;RiskPerformance&#39;:pred_dummy}), pd.Series(user_input, index=index)], axis=0)</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a><span class="co">    dummy_applicant = pd.DataFrame(dummy_applicant)</span></span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a><span class="co">    dummy_applicant = dummy_applicant.T.replace({&#39;RiskPerformance&#39;:{0.0:&#39;pred: approve&#39;, 1.0:&#39;pred: decline&#39;}}).T</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a><span class="co">    dummy_applicant = dummy_applicant.rename(columns={0:&#39;User Input&#39;})</span></span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a><span class="co">    if pred_dummy == 1.0:</span></span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a><span class="co">        explainer = ProtodashExplainer()</span></span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a><span class="co">        W, S, SetValues = explainer.explain(np.array(user_input).reshape(1,-1), bad_client_profiles.iloc[:, 1:].to_numpy(), m=3)</span></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = bad_client_profiles.iloc[S, :]</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.reset_index(drop=True)</span></span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.replace({&#39;RiskPerformance&#39;:{&#39;Good&#39;:&#39;approve&#39;, &#39;Bad&#39;:&#39;deny&#39;}})</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.rename(index={0:&#39;Existing Client 1&#39;, 1:&#39;Existing Client 2&#39;, 2:&#39;Existing Client 3&#39;})</span></span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.T</span></span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = pd.concat([dummy_applicant, similar_clients], axis=1)</span></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a><span class="co">    else:</span></span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a><span class="co">        explainer = ProtodashExplainer()</span></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a><span class="co">        W, S, SetValues = explainer.explain(np.array(user_input).reshape(1,-1), good_client_profiles.iloc[:, 1:].to_numpy(), m=3)</span></span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = good_client_profiles.iloc[S, :]</span></span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.reset_index(drop=True)</span></span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.replace({&#39;RiskPerformance&#39;:{&#39;Good&#39;:&#39;approve&#39;, &#39;Bad&#39;:&#39;deny&#39;}})</span></span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.rename(index={0:&#39;Existing Client 1&#39;, 1:&#39;Existing Client 2&#39;, 2:&#39;Existing Client 3&#39;})</span></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = similar_clients.T</span></span>
<span id="cb79-52"><a href="#cb79-52" aria-hidden="true" tabindex="-1"></a><span class="co">        similar_clients = pd.concat([dummy_applicant, similar_clients], axis=1)</span></span>
<span id="cb79-53"><a href="#cb79-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-54"><a href="#cb79-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-55"><a href="#cb79-55" aria-hidden="true" tabindex="-1"></a><span class="co">    slice_idx = pd.IndexSlice</span></span>
<span id="cb79-56"><a href="#cb79-56" aria-hidden="true" tabindex="-1"></a><span class="co">    slice_ = slice_idx[slice_idx[&#39;ExternalRiskEstimate&#39;:], slice_idx[&#39;Existing Client 1&#39;:&#39;Existing Client 3&#39;]]</span></span>
<span id="cb79-57"><a href="#cb79-57" aria-hidden="true" tabindex="-1"></a><span class="co">    return similar_clients.style.apply(lambda x: (abs((x+1e-10)/(similar_clients.iloc[1:, 0]+1e-10) - 1) &lt;= 0.2).map({True:&#39;background-color: yellow&#39;, False: &#39;&#39;}), subset=slice_).set_precision(0)</span></span>
<span id="cb79-58"><a href="#cb79-58" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
</div>
<div class="cell markdown" id="4ozlATgquYqP">
<p>dummy 0</p>
</div>
<div class="cell code" id="ctR91zcVQqB6">
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">## to test from front end, please use the following ways to generate client database and dummy applicants&#39; inputs</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co">## for protodash to work, the user inputs cannot be exactly the same as one of the instances in the client_database, </span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">## so it would be better if an extremely small number is added to each of the user inputs </span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co">## e.g. see what i did for the &#39;dummy applicant - declined&#39; below, where the values are extracted from existing database</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="co"># %%capture</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">#load model</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co"># xgb_model = xgb.XGBClassifier()</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># xgb_model.load_model(&#39;xgb.model&#39;)</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co">#random user input</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a><span class="co">#user_input = random.sample(list(range(100)), 23)</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co">#dummpy applicant - declined:</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="co">#user_declined = [i+1e-10 for i in client_database.iloc[0, 1:]] </span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co">#dummpy applicant - approved:</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="co">#user_approved = [i+1e-10 for i in client_database.iloc[10, 1:]]</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="co">#load the client database</span></span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="co">#client_database_path = &quot;heloc_dataset_v1.csv&quot;</span></span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="co">#client_database = pd.read_csv(&quot;heloc_dataset_v1.csv&quot;)</span></span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a><span class="co">#client_database.replace({-7:np.NaN, -8:np.NaN, -9:np.NaN}, inplace=True)</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co">#for i in range(1,24,1):</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">#client_database.iloc[:, i] = client_database.iloc[:, i].fillna(client_database.iloc[:, i].mean().round())</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="co">client_database = X_train.copy()   </span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co">client_database[&#39;RiskPerformance&#39;] = y_train.values</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a><span class="co"># impletement protodash</span></span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="co">df_only = display_similar_clients(xgb_model, X_dummy.iloc[0], client_database)</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="co">display(df_only)</span></span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="co">&#39;&#39;&#39;</span></span></code></pre></div>
</div>
<div class="cell code" id="f0FAtiTo-3l5">
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_similar_clients(ml_model, user_input): </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">&#39;&#39;&#39;</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="co">   take in user&#39;s input (as a list) for prediction; </span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co">   </span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="co">   &#39;&#39;&#39;</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sourcing from X_train and y_train, put all &#39;good&#39; samples together, all &#39;bad&#39; samples together</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  existing_client_profiles <span class="op">=</span> pd.concat([y_train, X_train], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>  good_client_con <span class="op">=</span> existing_client_profiles.copy()[<span class="st">&#39;RiskPerformance&#39;</span>] <span class="op">==</span> <span class="fl">0.0</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  good_client_profiles <span class="op">=</span> X_train.loc[good_client_con, :]</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  bad_client_con <span class="op">=</span> existing_client_profiles.copy()[<span class="st">&#39;RiskPerformance&#39;</span>] <span class="op">==</span> <span class="fl">1.0</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  bad_client_profiles <span class="op">=</span> X_train.loc[bad_client_con, :]</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make prediction on user input</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  index <span class="op">=</span> [<span class="st">&#39;ExternalRiskEstimate&#39;</span>, <span class="st">&#39;MSinceOldestTradeOpen&#39;</span>,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;MSinceMostRecentTradeOpen&#39;</span>, <span class="st">&#39;AverageMInFile&#39;</span>, <span class="st">&#39;NumSatisfactoryTrades&#39;</span>,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;NumTrades60Ever2DerogPubRec&#39;</span>, <span class="st">&#39;NumTrades90Ever2DerogPubRec&#39;</span>,</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;PercentTradesNeverDelq&#39;</span>, <span class="st">&#39;MSinceMostRecentDelq&#39;</span>,</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;MaxDelq2PublicRecLast12M&#39;</span>, <span class="st">&#39;MaxDelqEver&#39;</span>, <span class="st">&#39;NumTotalTrades&#39;</span>,</span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;NumTradesOpeninLast12M&#39;</span>, <span class="st">&#39;PercentInstallTrades&#39;</span>,</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;MSinceMostRecentInqexcl7days&#39;</span>, <span class="st">&#39;NumInqLast6M&#39;</span>, <span class="st">&#39;NumInqLast6Mexcl7days&#39;</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;NetFractionRevolvingBurden&#39;</span>, <span class="st">&#39;NetFractionInstallBurden&#39;</span>,</span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;NumRevolvingTradesWBalance&#39;</span>, <span class="st">&#39;NumInstallTradesWBalance&#39;</span>,</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>       <span class="st">&#39;NumBank2NatlTradesWHighUtilization&#39;</span>, <span class="st">&#39;PercentTradesWBalance&#39;</span>]</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>  pred_dummy <span class="op">=</span> ml_model.predict(np.array(user_input).reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>))[<span class="dv">0</span>]</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>  dummy_applicant <span class="op">=</span> pd.concat([pd.Series(user_input, index<span class="op">=</span>index), pd.Series({<span class="st">&#39;RiskPerformance&#39;</span>:pred_dummy})], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  dummy_applicant <span class="op">=</span> pd.DataFrame(dummy_applicant)</span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>  dummy_applicant <span class="op">=</span> dummy_applicant.T.replace({<span class="st">&#39;RiskPerformance&#39;</span>:{<span class="fl">0.0</span>:<span class="st">&#39;pred: approve&#39;</span>, <span class="fl">1.0</span>:<span class="st">&#39;pred: decline&#39;</span>}}).T</span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>  dummy_applicant <span class="op">=</span> dummy_applicant.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">&#39;User Input&#39;</span>})</span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># implement protodash</span></span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">## if prediction is 1.0, stack the dummy applicant with exsiting &#39;bad&#39; applicants</span></span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">## if prediction is 0.0, stack the dummy applicant with existing &#39;good&#39; applicants</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> pred_dummy <span class="op">==</span> <span class="fl">1.0</span>:</span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    explainer <span class="op">=</span> ProtodashExplainer()</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>    W, S, SetValues <span class="op">=</span> explainer.explain(np.array(user_input).reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>), bad_client_profiles.values, m<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> bad_client_profiles.iloc[S, :]</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a>    y_bad <span class="op">=</span> y_train[bad_client_con]</span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>    similar_clients[<span class="st">&#39;RiskPerformance&#39;</span>] <span class="op">=</span> y_bad.iloc[S].values</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.replace({<span class="st">&#39;RiskPerformance&#39;</span>:{<span class="fl">0.0</span>:<span class="st">&#39;approve&#39;</span>, <span class="fl">1.0</span>:<span class="st">&#39;deny&#39;</span>}})</span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.rename(index<span class="op">=</span>{<span class="dv">0</span>:<span class="st">&#39;Existing Client 1&#39;</span>, <span class="dv">1</span>:<span class="st">&#39;Existing Client 2&#39;</span>, <span class="dv">2</span>:<span class="st">&#39;Existing Client 3&#39;</span>})</span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.T</span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> pd.concat([dummy_applicant, similar_clients], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>:</span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>    explainer <span class="op">=</span> ProtodashExplainer()</span>
<span id="cb81-57"><a href="#cb81-57" aria-hidden="true" tabindex="-1"></a>    W, S, SetValues <span class="op">=</span> explainer.explain(np.array(user_input).reshape(<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>), good_client_profiles.values, m<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb81-58"><a href="#cb81-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-59"><a href="#cb81-59" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> good_client_profiles.iloc[S, :]</span>
<span id="cb81-60"><a href="#cb81-60" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb81-61"><a href="#cb81-61" aria-hidden="true" tabindex="-1"></a>    y_good <span class="op">=</span> y_train[good_client_con]</span>
<span id="cb81-62"><a href="#cb81-62" aria-hidden="true" tabindex="-1"></a>    similar_clients[<span class="st">&#39;RiskPerformance&#39;</span>] <span class="op">=</span> y_good.iloc[S].values</span>
<span id="cb81-63"><a href="#cb81-63" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.replace({<span class="st">&#39;RiskPerformance&#39;</span>:{<span class="fl">0.0</span>:<span class="st">&#39;approve&#39;</span>, <span class="fl">1.0</span>:<span class="st">&#39;deny&#39;</span>}})</span>
<span id="cb81-64"><a href="#cb81-64" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.rename(index<span class="op">=</span>{<span class="dv">0</span>:<span class="st">&#39;Existing Client 1&#39;</span>, <span class="dv">1</span>:<span class="st">&#39;Existing Client 2&#39;</span>, <span class="dv">2</span>:<span class="st">&#39;Existing Client 3&#39;</span>})</span>
<span id="cb81-65"><a href="#cb81-65" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> similar_clients.T</span>
<span id="cb81-66"><a href="#cb81-66" aria-hidden="true" tabindex="-1"></a>    similar_clients <span class="op">=</span> pd.concat([dummy_applicant, similar_clients], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb81-67"><a href="#cb81-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-68"><a href="#cb81-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-69"><a href="#cb81-69" aria-hidden="true" tabindex="-1"></a>  slice_idx <span class="op">=</span> pd.IndexSlice</span>
<span id="cb81-70"><a href="#cb81-70" aria-hidden="true" tabindex="-1"></a>  slice_ <span class="op">=</span> slice_idx[slice_idx[:<span class="st">&#39;PercentTradesWBalance&#39;</span>], slice_idx[<span class="st">&#39;Existing Client 1&#39;</span>:<span class="st">&#39;Existing Client 3&#39;</span>]]</span>
<span id="cb81-71"><a href="#cb81-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> similar_clients.style.<span class="bu">apply</span>(<span class="kw">lambda</span> x: (<span class="bu">abs</span>((x<span class="op">+</span><span class="fl">1e-10</span>)<span class="op">/</span>(similar_clients[<span class="st">&#39;User Input&#39;</span>][:<span class="op">-</span><span class="dv">1</span>]<span class="op">+</span><span class="fl">1e-10</span>) <span class="op">-</span> <span class="dv">1</span>) <span class="op">&lt;=</span> <span class="fl">0.2</span>).<span class="bu">map</span>({<span class="va">True</span>:<span class="st">&#39;background-color: yellow&#39;</span>, <span class="va">False</span>: <span class="st">&#39;&#39;</span>}), subset<span class="op">=</span>slice_).set_precision(<span class="dv">0</span>)</span></code></pre></div>
</div>
<div class="cell code" id="xSvdAHmPuSw6">
<div class="sourceCode" id="cb82"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>dummy_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>user_input <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> X_dummy.iloc[dummy_idx,:].values]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>display_similar_clients(xgb_model, user_input)</span></code></pre></div>
</div>
<section id="32-decision-tree" class="cell markdown" id="e1uFOmDm8vTz">
<h2><strong>3.2 Decision Tree</strong></h2>
</section>
<section id="321-global-explaination-by-shap" class="cell markdown" id="T4P1lGKd9wro">
<h3><strong>3.2.1 Global Explaination by SHAP</strong></h3>
</section>
<div class="cell code" id="H7wYjAoh8uZL">
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># explian global model using TreeExplainer</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.TreeExplainer(dt_model)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_train)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values[<span class="dv">1</span>], X_train)</span></code></pre></div>
</div>
<div class="cell code" id="KlEdSD8S8uo5">
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values[<span class="dv">1</span>], X_train, plot_type<span class="op">=</span><span class="st">&#39;bar&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="u0skdZQb-NCe">
<div class="sourceCode" id="cb85"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in range(7):</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   shap.dependence_plot(i, shap_values, X_train)</span></span></code></pre></div>
</div>
<div class="cell code" id="rDyo3kLEfaf2">
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ExternalRiskEstimate&quot;</span>, dt_model.predict, X_train, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="cell code" id="DPNCSQWf0K5b">
<div class="sourceCode" id="cb87"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NumSatisfactoryTrades&quot;</span>, dt_model.predict, X_train, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="cell code" id="feszzvR30ddM">
<div class="sourceCode" id="cb88"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;MSinceMostRecentInqexcl7days&quot;</span>, dt_model.predict, X_train, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<section id="322-local-explaination-by-lime" class="cell markdown" id="g484U10S6eyF">
<h3>3.2.2 Local Explaination by LIME</h3>
</section>
<div class="cell markdown" id="PUeH0Dea4sFd">

</div>
<div class="cell code" id="4wXhzs0SuqrI">
<div class="sourceCode" id="cb89"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explain individual prediction using LimeTabularExplainer</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> lime.lime_tabular.LimeTabularExplainer(X_train.values, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                                                   feature_names<span class="op">=</span>X_train.columns, </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                                                   verbose<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                                                   class_names<span class="op">=</span>[<span class="st">&#39;Approved&#39;</span>, <span class="st">&#39;Denied&#39;</span>],</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                                                   mode<span class="op">=</span><span class="st">&#39;classification&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="fESMYclQ5CQq">
<div class="sourceCode" id="cb90"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># storing a new observation</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># i = random.randint(0, len(X_test))</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># X_observation = X_test.iloc[i, :]</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, LIME explain the prediction on the 1st observation of dummy dataset</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>X_dummy_observation <span class="op">=</span> X_dummy.iloc[<span class="dv">0</span>]        <span class="co"># This is for front-end to pick the observation </span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>explanation <span class="op">=</span> explainer.explain_instance(X_dummy_observation.values, dt_model.predict_proba)</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>explanation.show_in_notebook()</span></code></pre></div>
</div>
<div class="cell markdown" id="x8OelSdc-bOb">
<p>** tabular format **</p>
</div>
<div class="cell code" id="mw79Olfg-add">
<div class="sourceCode" id="cb91"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>result_list <span class="op">=</span> explanation.as_list()</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [tup[<span class="dv">0</span>] <span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="bu">round</span>(tup[<span class="dv">1</span>], <span class="dv">2</span>)<span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>exp_df <span class="op">=</span> pd.DataFrame([values], columns<span class="op">=</span>columns)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>exp_df.T</span></code></pre></div>
</div>
<div class="cell markdown" id="RLKSEUik-vDw">
<hr />
</div>
<div class="cell code" id="BRLGrint5Ca0">
<div class="sourceCode" id="cb92"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Another example, LIME explain the prediction on the 4th observation of dummy dataset</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>dummy_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>X_dummy_observation <span class="op">=</span> X_dummy.iloc[dummy_idx]         </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>explanation <span class="op">=</span> explainer.explain_instance(X_dummy_observation.values, dt_model.predict_proba)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>explanation.show_in_notebook()</span></code></pre></div>
</div>
<div class="cell markdown" id="O4l8drai_DuJ">
<p>** tabular format **</p>
</div>
<div class="cell code" id="LWlHp-57_IUJ">
<div class="sourceCode" id="cb93"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>result_list <span class="op">=</span> explanation.as_list()</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [tup[<span class="dv">0</span>] <span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="bu">round</span>(tup[<span class="dv">1</span>], <span class="dv">2</span>)<span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>exp_df <span class="op">=</span> pd.DataFrame([values], columns<span class="op">=</span>columns)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>exp_df.T</span></code></pre></div>
</div>
<div class="cell markdown" id="2Nn3XZJt_Kin">
<hr />
<hr />
</div>
<section id="323-local-explaination-by-protodash" class="cell markdown" id="s39aHlU1sPoW">
<h3>3.2.3 Local Explaination by ProtoDash</h3>
</section>
<div class="cell code" id="PMPelPVkseXw">
<div class="sourceCode" id="cb94"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>dummy_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>user_input <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> X_dummy.iloc[dummy_idx,:].values]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>display_similar_clients(dt_model, user_input)</span></code></pre></div>
</div>
<section id="33-support-vector-machine" class="cell markdown" id="tZ7ZRM7e9hka">
<h2><strong>3.3 Support Vector Machine</strong></h2>
</section>
<section id="331-global-explaination-by-shap" class="cell markdown" id="qFmENMeY-u3L">
<h3><strong>3.3.1 Global Explaination by SHAP</strong></h3>
</section>
<div class="cell code" id="GP_fp0dR8urS">
<div class="sourceCode" id="cb95"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explain global model using KernelExplainer</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>X_shap_svc_testsample <span class="op">=</span> shap.utils.sample(X_train, <span class="dv">20</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>explainer_all <span class="op">=</span> shap.KernelExplainer(model<span class="op">=</span>svc.predict_proba, data<span class="op">=</span>X_shap_svc_testsample, link<span class="op">=</span><span class="st">&quot;logit&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="G0Qis7vk8uuw">
<div class="sourceCode" id="cb96"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> shap.KernelExplainer(model<span class="op">=</span>svc.predict_proba,data<span class="op">=</span>X_shap_svc_testsample)</span></code></pre></div>
</div>
<div class="cell code" id="KGpjPXs7_MHB">
<div class="sourceCode" id="cb97"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Be patient! This&#39;ll take a while to run. We can modify the number of test sample,the bigger sample the longer it runs. </span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>shap_values <span class="op">=</span> explainer.shap_values(X_shap_svc_testsample, approximate<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" id="Pw7MLKFA_R4h">
<div class="sourceCode" id="cb98"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>shap.summary_plot(shap_values[<span class="dv">1</span>], X_shap_svc_testsample)</span></code></pre></div>
</div>
<div class="cell code" id="tI0pbDdIA0co">
<div class="sourceCode" id="cb99"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;ExternalRiskEstimate&quot;</span>, svc_model.predict, X_shap_svc_testsample, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="cell code" id="4PsdE3LnBOSA">
<div class="sourceCode" id="cb100"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;NetFractionRevolvingBurden&quot;</span>, svc_model.predict, X_shap_svc_testsample, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div class="cell code" id="5shMat8-BfxO">
<div class="sourceCode" id="cb101"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>shap.partial_dependence_plot(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;AverageMInFile&quot;</span>, svc_model.predict, X_shap_svc_testsample, model_expected_value<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    feature_expected_value<span class="op">=</span><span class="va">True</span>, ice<span class="op">=</span><span class="va">False</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
<section id="332-local-explaination-by-lime" class="cell markdown" id="UsBMwINt7Gul">
<h3>3.3.2 Local Explaination by LIME</h3>
</section>
<div class="cell code" id="mVMLO0pq_Fjh">
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explain individual prediction using LimeTabularExplainer</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>explainer <span class="op">=</span> lime.lime_tabular.LimeTabularExplainer(X_train.values, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                                                   feature_names<span class="op">=</span>X_train.columns, </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                                                   verbose<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                                                   class_names<span class="op">=</span>[<span class="st">&#39;Approved&#39;</span>, <span class="st">&#39;Denied&#39;</span>],</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                                                   mode<span class="op">=</span><span class="st">&#39;classification&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="LS0VEsSb7RXM">
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For example, LIME explain the prediction on the 4th observation of dummy dataset</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>dummy_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>X_dummy_observation <span class="op">=</span> X_dummy.iloc[dummy_idx]      </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>explanation <span class="op">=</span> explainer.explain_instance(X_dummy_observation.values, svc_model.predict_proba)</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>explanation.show_in_notebook()</span></code></pre></div>
</div>
<div class="cell markdown" id="x0I_nqYY_h6i">
<p>** tabular format **</p>
</div>
<div class="cell code" id="DiejO5ZK_leV">
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>result_list <span class="op">=</span> explanation.as_list()</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> [tup[<span class="dv">0</span>] <span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> [<span class="bu">round</span>(tup[<span class="dv">1</span>], <span class="dv">2</span>)<span class="cf">for</span> tup <span class="kw">in</span> result_list]</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>exp_df <span class="op">=</span> pd.DataFrame([values], columns<span class="op">=</span>columns)</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>exp_df.T</span></code></pre></div>
</div>
<div class="cell markdown" id="vBRtOSle_nsQ">
<hr />
<hr />
</div>
<section id="333-local-explaination-by-protodash" class="cell markdown" id="FxvmcZSGtT42">
<h3>3.3.3 Local Explaination by ProtoDash</h3>
</section>
<div class="cell code" id="fwPOzb-y7Rak">
<div class="sourceCode" id="cb105"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>dummy_idx <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>user_input <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> X_dummy.iloc[dummy_idx,:].values]</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>display_similar_clients(svc_model, user_input)</span></code></pre></div>
</div>
<div class="cell code" id="u0cGDtUlxqsj">
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
